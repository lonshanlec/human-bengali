import feedparser
import google.generativeai as genai
import requests
import os

# Secrets / Environment Variables
RSS_URL = os.getenv("RSS_URL")
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
FB_PAGE_ID = os.getenv("FB_PAGE_ID")
FB_ACCESS_TOKEN = os.getenv("FB_ACCESS_TOKEN")

# 1) RSS থেকে লেটেস্ট টাইটেল
feed = feedparser.parse(RSS_URL)
if len(feed.entries) == 0:
    print("RSS ফিড খালি! নতুন আর্টিকেল নেই।")
    exit(0)

latest_title = feed.entries[0].title
print("Latest Article Title:", latest_title)

# 2) Gemini-2.5-Flash দিয়ে নিউজ জেনারেট
genai.configure(api_key=GEMINI_API_KEY)
model = genai.GenerativeModel("gemini-2.5-flash")

prompt = f"এই টাইটেল থেকে আকর্ষণীয় নিউজ বানাও (মানুষ পড়তে চাইবে এমনভাবে): {latest_title}"
response = model.generate_content(prompt)
news_content = response.text.strip()

if not news_content:
    print("Gemini content generate হয়নি।")
    exit(0)

print("Generated News Content:", news_content)

# 3) ফেসবুকে পোস্ট করা
post_url = f"https://graph.facebook.com/{FB_PAGE_ID}/feed"
payload = {
    "message": news_content,
    "access_token": FB_ACCESS_TOKEN
}
res = requests.post(post_url, data=payload)
print("Facebook Response:", res.json())
